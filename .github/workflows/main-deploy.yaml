name: Auto OSS Release Sync

on:
  push:
    branches:
      - main
      - develop
env:
  GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}

jobs:
  sync:
    name: ğŸ¿ Sync
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ›‘ Cancel Previous Runs
        uses: styfle/cancel-workflow-action@0.10.0

      - name: â” Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 16

      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v3

      - name: ğŸ­ Checkout the OSS Releaser
        uses: actions/checkout@v3
        with:
          repository: "CrystallizeAPI/oss-releaser"
          path: oss-releaser

      - name: âœ¨ Install the OSS Releaser
        run: cd oss-releaser && make install

      - name: ğŸ” Install Splitsh-lite
        run: |
          curl https://github.com/splitsh/lite/releases/download/v1.0.1/lite_linux_amd64.tar.gz
          tar -zxpf lite_linux_amd64.tar.gz --directory /usr/local/bin/

      - name: ğŸš€ Sync it!
        run: oss-releaser sync
